# Spring Batch + Scheduler + PostgreSQL (Docker)

Run PostgreSQL docker container:

        docker run --name batch-postgres -d  -p 5432:5432 postgres
        

###Общие принципы пакетной обработки
При создании пакетного решения следует учитывать следующие ключевые принципы, рекоментадации и общие положения:
1. Пакетная архитектура обычно влияет на онлайн-архитектуру и наоборот. 
2. Максимально упростите и избегайте построения сложных логических стурктур в пакетных приложениях
3. Держите обработку и хранение данных физически близко друг к дуругу (affinity)
4. Минимизация использования системных реусурсов, особенно I/O. Выполняйте как можно больше операций во внутренней памяти
5. Изучите операции ввода/вывода (анализ SQL statement), чтобы избежать ненужного физического I/O. В частности, избегайте следующего:
    5. Чтение данных для каждой транзакции, когда данные могут быть прочитаны один раз и кэшированы или сохранены в рабочем хранилище
    5. Перечитывание данных для транзакции, данные которой считывались ранее в той же транзакции
    5. Вызывает ненужно сканирование таблиц или индексов.
    5. Отсутствие усвий в выражении WHERE sql запросов.
6. Избегайте двойного выполнения одной и той же работы.
7. Всегда предполагайте худшее в отношении целостности данных. 
8. Реализуйте различные внутрении проверки и чексуммы для проверки корректности выполнения
9. Планируйте и реализуйте стрес тестирование

###Стратегии пакетной обработки


### Асинхронный запуск Job
Для асинхронного запуска джобы необходимо создать специальный Executor service и передать его в Job Launcher:

    jobLauncher.setTaskExecutor(new SimpleAsyncTaskExecutor());


###Транзакции
Транзакционность обеспечивается только для шагов (tasklet)

###Дополнительно
##### allow-start-if-complete
Эта настройка для шага позволяет перезапускать его. На основе этой настройки можно сделать мониторинг состояния.


### Scaling
When your Job needs to have the ability to scale out, Spring Batch makes it easy and, out of the box, provides two modes of parallel processing: Single Process (multi-threaded), and Multi-Process.

|PROCESSING METHOD	|PROCESSING TYPE|
|:------------------|--------------:|
|Multi-Threaded Step	|Single process|
|Parallel Steps	|Single process|
|Step Remote Chunking	|Multi process|
|Step Partitioning	|Multi process|

Выполнение задач:
1. Последовательно
2. Последовательно с условием
    2. Можно задавать условия досрочного завершения джобы
    2. Поток может выполняться по различным ветвям

     
Spring Batch Documentation on [spring.io](https://docs.spring.io/spring-batch/4.0.x/reference/html/index.html)
